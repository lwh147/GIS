function index_body_index_init(){map_mapInitial();$(".hamburger").click(function(){$(this).toggleClass("is-active")});mapChartInitial()}function map_mapInitial(){const l=L.tileLayer.chinaProvider("TianDiTu.Normal.Map",{maxZoom:20,minZoom:5}),s=L.tileLayer.chinaProvider("TianDiTu.Normal.Annotion",{maxZoom:20,minZoom:5}),j=L.tileLayer.chinaProvider("TianDiTu.Satellite.Map",{maxZoom:20,minZoom:5}),q=L.tileLayer.chinaProvider("TianDiTu.Satellite.Annotion",{maxZoom:20,minZoom:5});const e=L.tileLayer.chinaProvider("Google.Normal.Map",{maxZoom:20,minZoom:5}),c=L.tileLayer.chinaProvider("Google.Satellite.Map",{maxZoom:20,minZoom:5});const r=L.layerGroup([l,s]),h=L.layerGroup([j,q]),n=L.layerGroup([c]);const p={"天地图":h,Google:n},g={};const d=[40.434209,109.600875];const m=[40.433294,109.595275];const b=[40.437924,109.604577];const k=[[40.433355,109.595286],[40.433322,109.595361],[40.433232,109.595339],[40.433249,109.5952],[40.43333,109.595178]];const a=[[40.433349,109.595275],[40.433349,109.595275],[40.433253,109.595321],[40.433247,109.595229],[40.433311,109.595208]];const f=[40.435071,109.607786];const o=L.map("testMap",{center:f,zoom:15,layers:[h],zoomControl:false});L.control.layers(p,g).addTo(o);L.control.zoom({zoomInTitle:"放大",zoomOutTitle:"缩小"}).addTo(o);L.control.scale().addTo(o);L.control.measure({position:"topleft"}).addTo(o);o.pm.addControls({position:"topleft"});popTest(o);mapDrawField(m,o);infoTipListener();$(".hamburger").toggleClass("is-active")}function mapChartInitial(){let id="1-1";let latlng=[40.43428,109.595361];fieldInfo(id,latlng);swcChart(id);fwhChart(id)}function mapDrawField(a,b){let startAngle=[];for(let i=0;i<15;i++){startAngle[i]=-30+24*i}let radius=[390,320,225];let infoGroup=[];for(let i=0;i<radius.length;i++){let tmpGroup=mapFieldOutline(a,startAngle[0],radius[i],b);infoGroup.push.apply(infoGroup,tmpGroup)}window.sessionStorage.setItem("fieldInfos",JSON.stringify(infoGroup))}function mapFieldOutline(d,b,a,c){let tmpAngle=b;let fieldInfos=[];for(let i=0;i<5;i++){drawSector(d,a,[tmpAngle,tmpAngle+72],c);let area=null;let area1=Math.PI*390*390;let area2=Math.PI*320*320;let area3=Math.PI*225*225;if(a===225){area=area3}if(a===320){area=area2-area3}if(a===390){area=area1-area2}let fieldInfo={id:mapCalculateID(tmpAngle,a),area:(area/5).toFixed(3)};tmpAngle+=72;fieldInfos.push(fieldInfo)}return fieldInfos}function mapCalculateID(b,a){let id="";switch(b){case -30:id="1";break;case 42:id="2";break;case 114:id="3";break;case 186:id="4";break;case 258:id="5";break}switch(a){case 225:id+="-1";break;case 320:id+="-2";break;case 390:id+="-3";break}return id}function addMarker(b,a){L.marker(b,{title:"I'm a marker",icon:L.BeautifyIcon.icon({icon:"leaf",iconShape:"marker"})}).addTo(a)}function drawMyCircle(c,a,b){return L.circle(c,{radius:a,color:"#389466",weight:2}).addTo(b)}function drawSector(c,a,d,b){let sector=L.semiCircle(c,{radius:a,color:"#389466",weight:2,startAngle:d[0],stopAngle:d[1]}).addTo(b);sector.on("click",function(e){let fieldId=mapCalculateID(d[0],a);addMarker(e.latlng,b);fieldInfo(fieldId,e.latlng);swcChart(fieldId);fwhChart(fieldId)});return sector}function getArcPoints(b,a,c,e,d){let points=[];console.log("center is "+b);for(let i=0;i<=d;i++){let current=(c+e*i/d)*Math.PI/180;let cos=Math.cos(current);let sin=Math.sin(current);points.push([b[0]+a*cos,b[1]+a*sin]);console.log("radius is "+a);console.log("cos is "+cos+" sin is "+sin)}return points}function getDistance(b,a){let x=b[0]-a[0];let y=b[1]-a[1];return Math.sqrt(x*x+y*y).toFixed(9)}function drawLine(b,a){return L.polyline(b,{color:"#389466",weight:2}).addTo(a)}let strs="";let newStrs="";function popTest(a){a.on("click",function(b){strs+=b.latlng.toString()})}function transform(){if(strs!==""){for(let i=0;i<strs.length;i++){if(strs.charAt(i)!=="("){continue}let secondPoint=i;while(strs.charAt(secondPoint)!==")"){secondPoint++}let latlng=strs.substring(i+1,secondPoint);newStrs+="["+latlng+"],\n";i=secondPoint}console.log(newStrs)}else{alert("str is null")}}function infoTipListener(){$(".info-tip").on("click",function(){let infoWindow=$(".info-window");if(infoWindow.css("display")==="none"){$(".hamburger").addClass("is-active");$(infoWindow).fadeIn("normal","linear")}else{$(".hamburger").removeClass("is-active");$(infoWindow).fadeOut("normal","linear")}})}function fieldInfo(a,b){let infoData=window.sessionStorage.getItem("fieldInfos");infoData=JSON.parse(infoData);let tbody=$("#info-win-chart1").children().children()[0];let tds=$(tbody).children().children();$.each(infoData,function(c,d){if(d.id===a){$(tds[1]).text(d.id);$(tds[3]).text(b.toString().substring(6));$(tds[5]).text(d.area)}})}function swcChart(a){let chartData=screenDataByAttr(getChartDataByCache("field/swcByDOY",JSON.stringify({DOY:"177"})),"nUM_1",a);let xAxisData=extractCol(chartData,"nUM_3");let yAxisData=extractCol(chartData,"sWC");let swcOption={legend:{},tooltip:{},xAxis:{type:"category",name:"depth(cm)",nameLocation:"center",nameGap:20,data:xAxisData.sort(function(d,c){return d-c})},yAxis:{name:"%"},series:[{type:"bar",name:"SWC",data:yAxisData}]};getAndInitChart("info-win-chart2").setOption(swcOption)}function fwhChart(a){let chartData=screenDataByAttr(getChartDataByCache("field/fwh",null,0),"nUM_1",a);let names=extractCol(chartData,"nUM_2");let messFWH=extractCol(chartData,"massWaterContent");let volumeFWH=extractCol(chartData,"volumeWaterContent");let messData=[],volumeData=[];for(let i=0;i<names.length;i++){messData.push({name:names[i],value:messFWH[i]});volumeData.push({name:names[i],value:volumeFWH[i]})}let labelCfg={};let option1={title:{subtext:"MessWaterContent",left:"50%",top:"80%",textAlign:"center"},legend:{},tooltip:{},series:{type:"pie",center:["50%","45%"],radius:"50%",data:messData,label:labelCfg}},option2={title:{subtext:"VolumeWaterContent",left:"50%",top:"85%",textAlign:"center"},legend:{top:"5%"},tooltip:{},series:{type:"pie",center:["50%","50%"],radius:"50%",data:volumeData,label:labelCfg}};getAndInitChart("info-win-chart3").setOption(option1);getAndInitChart("info-win-chart4").setOption(option2)};